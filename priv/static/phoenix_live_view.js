function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(i=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o,u="http://www.w3.org/1999/xhtml",a="undefined"==typeof document?void 0:document;function c(e,t){var n=e.nodeName,i=t.nodeName;return n===i||!!(t.actualize&&n.charCodeAt(0)<91&&i.charCodeAt(0)>90)&&n===i.toUpperCase()}function s(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){s(e,t,"selected")},INPUT:function(e,t){s(e,t,"checked"),s(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var i=e.firstChild;if(i){var r=i.nodeValue;if(r==n||!n&&r==e.placeholder)return;i.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n=0,i=t.firstChild;i;){var r=i.nodeName;if(r&&"OPTION"===r.toUpperCase()){if(i.hasAttribute("selected"))break;n++}i=i.nextSibling}e.selectedIndex=n}}},d=1,h=3,f=8;function v(){}function p(e){return e.id}var y=function(e){return function(t,n,i){if(i||(i={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName){var r=n;(n=a.createElement("html")).innerHTML=r}else s=n,!o&&a.createRange&&(o=a.createRange()).selectNode(a.body),o&&o.createContextualFragment?y=o.createContextualFragment(s):(y=a.createElement("body")).innerHTML=s,n=y.childNodes[0];var s,y,b,m=i.getNodeKey||p,g=i.onBeforeNodeAdded||v,A=i.onNodeAdded||v,k=i.onBeforeElUpdated||v,w=i.onElUpdated||v,E=i.onBeforeNodeDiscarded||v,x=i.onNodeDiscarded||v,S=i.onBeforeElChildrenUpdated||v,C=!0===i.childrenOnly,N={};function T(e){b?b.push(e):b=[e]}function L(e,t,n){!1!==E(e)&&(t&&t.removeChild(e),x(e),function e(t,n){if(t.nodeType===d)for(var i=t.firstChild;i;){var r=void 0;n&&(r=m(i))?T(r):(x(i),i.firstChild&&e(i,n)),i=i.nextSibling}}(e,n))}function V(e){A(e);for(var t=e.firstChild;t;){var n=t.nextSibling,i=m(t);if(i){var r=N[i];r&&c(t,r)&&(t.parentNode.replaceChild(r,t),B(r,t))}V(t),t=n}}function B(i,r,o){var u,s=m(r);if(s&&delete N[s],!n.isSameNode||!n.isSameNode(t)){if(!o){if(!1===k(i,r))return;if(e(i,r),w(i),!1===S(i,r))return}if("TEXTAREA"!==i.nodeName){var v,p,y,b,A=r.firstChild,E=i.firstChild;e:for(;A;){for(y=A.nextSibling,v=m(A);E;){if(p=E.nextSibling,A.isSameNode&&A.isSameNode(E)){A=y,E=p;continue e}u=m(E);var x=E.nodeType,C=void 0;if(x===A.nodeType&&(x===d?(v?v!==u&&((b=N[v])?E.nextSibling===b?C=!1:(i.insertBefore(b,E),p=E.nextSibling,u?T(u):L(E,i,!0),E=b):C=!1):u&&(C=!1),(C=!1!==C&&c(E,A))&&B(E,A)):x!==h&&x!=f||(C=!0,E.nodeValue!==A.nodeValue&&(E.nodeValue=A.nodeValue))),C){A=y,E=p;continue e}u?T(u):L(E,i,!0),E=p}if(v&&(b=N[v])&&c(b,A))i.appendChild(b),B(b,A);else{var I=g(A);!1!==I&&(I&&(A=I),A.actualize&&(A=A.actualize(i.ownerDocument||a)),i.appendChild(A),V(A))}A=y,E=p}for(;E;)p=E.nextSibling,(u=m(E))?T(u):L(E,i,!0),E=p}var O=l[i.nodeName];O&&O(i,r)}}!function e(t){if(t.nodeType===d)for(var n=t.firstChild;n;){var i=m(n);i&&(N[i]=n),e(n),n=n.nextSibling}}(t);var I,O,R=t,F=R.nodeType,j=n.nodeType;if(!C)if(F===d)j===d?c(t,n)||(x(t),R=function(e,t){for(var n=e.firstChild;n;){var i=n.nextSibling;t.appendChild(n),n=i}return t}(t,(I=n.nodeName,(O=n.namespaceURI)&&O!==u?a.createElementNS(O,I):a.createElement(I)))):R=n;else if(F===h||F===f){if(j===F)return R.nodeValue!==n.nodeValue&&(R.nodeValue=n.nodeValue),R;R=n}if(R===n)x(t);else if(B(R,n,C),b)for(var P=0,U=b.length;P<U;P++){var D=N[b[P]];D&&L(D,D.parentNode,!1)}return!C&&R!==t&&t.parentNode&&(R.actualize&&(R=R.actualize(t.ownerDocument||a)),t.parentNode.replaceChild(R,t)),R}}(function(e,t){var n,i,r,o,u,a=t.attributes;for(n=a.length-1;n>=0;--n)r=(i=a[n]).name,o=i.namespaceURI,u=i.value,o?(r=i.localName||r,e.getAttributeNS(o,r)!==u&&e.setAttributeNS(o,r,u)):e.getAttribute(r)!==u&&e.setAttribute(r,u);for(n=(a=e.attributes).length-1;n>=0;--n)!1!==(i=a[n]).specified&&(r=i.name,(o=i.namespaceURI)?(r=i.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r))}),b="data-phx-view",m="[".concat(b,"]"),g=["text","textarea","number","email","password","search","tel","url"],A=100,k="phx-",w=function(e,t,n,i){console.log("".concat(e.id," ").concat(t,": ").concat(n," - "),i)},E=function(t){return"object"===e(t)&&!(t instanceof Array)},x=function(e,t){return e?e[t]:null},S=function(e){return new URLSearchParams(new FormData(e)).toString()},C={mergeDiff:function(e,t){return this.isNewFingerprint(t)?t:(function e(t,n){for(var i in n){var r=n[i];E(r)&&t[i]?e(t[i],r):t[i]=r}}(e,t),e)},isNewFingerprint:function(){return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).static},toString:function(e){var t={buffer:""};return this.toOutputBuffer(e,t),t.buffer},toOutputBuffer:function(e,t){if(e.dynamics)return this.comprehensionToBuffer(e,t);var n=e.static;t.buffer+=n[0];for(var i=1;i<n.length;i++)this.dynamicToBuffer(e[i-1],t),t.buffer+=n[i]},comprehensionToBuffer:function(e,t){for(var n=e.dynamics,i=e.static,r=0;r<n.length;r++){var o=n[r];t.buffer+=i[0];for(var u=1;u<i.length;u++)this.dynamicToBuffer(o[u-1],t),t.buffer+=i[u]}},dynamicToBuffer:function(e,t){E(e)?this.toOutputBuffer(e,t):t.buffer+=e}},N=function(){function e(n){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e),this.unloaded=!1;var o=window.PhxSocket;this.socket=new o(n,r),this.socket.onOpen(function(){i.isUnloaded()&&(i.destroyAllViews(),i.joinRootViews()),i.unloaded=!1}),window.addEventListener("beforeunload",function(e){i.unloaded=!0}),this.bindingPrefix=r.bindingPrefix||k,this.opts=r,this.views={},this.viewLogger=r.viewLogger,this.activeElement=null,this.prevActive=null,this.silenced=!1,this.bindTopLevelEvents()}return i(e,[{key:"isUnloaded",value:function(){return this.unloaded}},{key:"getSocket",value:function(){return this.socket}},{key:"log",value:function(e,t,n){if(this.viewLogger){var i=r(n(),2),o=i[0],u=i[1];this.viewLogger(e,t,o,u)}}},{key:"connect",value:function(){var e=this;return["complete","loaded","interactive"].indexOf(document.readyState)>=0?this.joinRootViews():document.addEventListener("DOMContentLoaded",function(){e.joinRootViews()}),this.socket.connect()}},{key:"getBindingPrefix",value:function(){return this.bindingPrefix}},{key:"binding",value:function(e){return"".concat(this.getBindingPrefix()).concat(e)}},{key:"disconnect",value:function(){this.socket.disconnect()}},{key:"channel",value:function(e,t){return this.socket.channel(e,t||{})}},{key:"joinRootViews",value:function(){var e=this;document.querySelectorAll("".concat(m,":not([").concat("data-phx-parent-id","])")).forEach(function(t){e.joinView(t)})}},{key:"joinView",value:function(e,t){if(!this.getViewById(e.id)){var n=new V(e,this,t);this.views[n.id]=n,n.join()}}},{key:"owner",value:function(e,t){var n=this.getViewById(x(e.closest(m),"id"));n&&t(n)}},{key:"getViewById",value:function(e){return this.views[e]}},{key:"onViewError",value:function(e){this.dropActiveElement(e)}},{key:"destroyAllViews",value:function(){for(var e in this.views)this.destroyViewById(e)}},{key:"destroyViewById",value:function(e){var t=this.views[e];t&&(delete this.views[t.id],t.destroy())}},{key:"setActiveElement",value:function(e){var t=this;if(this.activeElement!==e){this.activeElement=e;var n=function(){e===t.activeElement&&(t.activeElement=null),e.removeEventListener("mouseup",t),e.removeEventListener("touchend",t)};e.addEventListener("mouseup",n),e.addEventListener("touchend",n)}}},{key:"getActiveElement",value:function(){return document.activeElement===document.body&&this.activeElement||document.activeElement}},{key:"dropActiveElement",value:function(e){this.prevActive&&e.ownsElement(this.prevActive)&&(this.prevActive=null)}},{key:"restorePreviouslyActiveFocus",value:function(){this.prevActive&&this.prevActive!==document.body&&this.prevActive.focus()}},{key:"blurActiveElement",value:function(){this.prevActive=this.getActiveElement(),this.prevActive!==document.body&&this.prevActive.blur()}},{key:"bindTopLevelEvents",value:function(){this.bindClicks(),this.bindForms(),this.bindTargetable({keyup:"keyup",keydown:"keydown"},function(e,t,n,i,r,o){n.pushKey(i,t,e,r)}),this.bindTargetable({blur:"focusout",focus:"focusin"},function(e,t,n,i,r,o){o||n.pushEvent(t,i,r)}),this.bindTargetable({blur:"blur",focus:"focus"},function(e,t,n,i,r,o){o&&"window"!==!o&&n.pushEvent(t,i,r)})}},{key:"bindTargetable",value:function(e,t){var n=this,i=function(i){var r=e[i];n.on(r,function(e){var r=n.binding(i),o=n.binding("target"),u=e.target.getAttribute&&e.target.getAttribute(r);u&&!e.target.getAttribute(o)?n.owner(e.target,function(n){return t(e,i,n,e.target,u,null)}):document.querySelectorAll("[".concat(r,"][").concat(o,"=window]")).forEach(function(o){var u=o.getAttribute(r);n.owner(o,function(n){return t(e,i,n,o,u,"window")})})})};for(var r in e)i(r)}},{key:"bindClicks",value:function(){var e=this;window.addEventListener("click",function(t){var n=e.binding("click"),i=function(e,t){do{if(e.matches("[".concat(t,"]")))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType&&!e.matches(m));return null}(t.target,n),r=i&&i.getAttribute(n);r&&(t.preventDefault(),e.owner(i,function(e){return e.pushEvent("click",i,r)}))},!1)}},{key:"bindForms",value:function(){var e=this;this.on("submit",function(t){var n=t.target.getAttribute(e.binding("submit"));n&&(t.preventDefault(),t.target.disabled=!0,e.owner(t.target,function(e){return e.submitForm(t.target,n)}))},!1);for(var t=function(){var t=i[n];e.on(t,function(n){var i=n.target;if("input"!==t||!["checkbox","radio","select-one","select-multiple"].includes(i.type)){var r=i.form&&i.form.getAttribute(e.binding("change"));r&&e.owner(i,function(t){L.isTextualInput(i)?i.setAttribute("data-phx-has-focused",!0):e.setActiveElement(i),t.pushInput(i,r)})}},!1)},n=0,i=["change","input"];n<i.length;n++)t()}},{key:"silenceEvents",value:function(e){this.silenced=!0,e(),this.silenced=!1}},{key:"on",value:function(e,t){var n=this;window.addEventListener(e,function(e){n.silenced||t(e)})}}]),e}(),T={setCookie:function(e,t){document.cookie="".concat(e,"=").concat(t)},getCookie:function(e){return document.cookie.replace(new RegExp("(?:(?:^|.*;s*)".concat(e,"s*=s*([^;]*).*$)|^.*$")),"$1")},redirect:function(e,t){t&&T.setCookie("__phoenix_flash__",t+"; max-age=60000; path=/"),window.location=e}},L={disableForm:function(e,t){var n="".concat(t).concat("disable-with");e.classList.add("phx-loading"),e.querySelectorAll("[".concat(n,"]")).forEach(function(e){var t=e.getAttribute(n);e.setAttribute("".concat(n,"-restore"),e.innerText),e.innerText=t}),e.querySelectorAll("button").forEach(function(e){e.setAttribute("data-phx-disabled",e.disabled),e.disabled=!0}),e.querySelectorAll("input").forEach(function(e){e.setAttribute("data-phx-readonly",e.readOnly),e.readOnly=!0})},restoreDisabledForm:function(e,t){var n="".concat(t).concat("disable-with");e.classList.remove("phx-loading"),e.querySelectorAll("[".concat(n,"]")).forEach(function(e){var t=e.getAttribute("".concat(n,"-restore"));t&&(e.innerText=t,e.removeAttribute("".concat(n,"-restore")))}),e.querySelectorAll("button").forEach(function(e){var t=e.getAttribute("data-phx-disabled");t&&(e.disabled="true"===t,e.removeAttribute("data-phx-disabled"))}),e.querySelectorAll("input").forEach(function(e){var t=e.getAttribute("data-phx-readonly");t&&(e.readOnly="true"===t,e.removeAttribute("data-phx-readonly"))})},discardError:function(e){var t=e.getAttribute&&e.getAttribute("data-phx-error-for");if(t){var n=document.getElementById(t);!t||n.getAttribute("data-phx-has-focused")||n.form.getAttribute("data-phx-has-submitted")||(e.style.display="none")}},isPhxChild:function(e){return e.getAttribute&&e.getAttribute("data-phx-parent-id")},patch:function(e,t,n,i){var r=e.liveSocket.getActiveElement(),o=null,u=null;L.isTextualInput(r)&&(o=r.selectionStart,u=r.selectionEnd),y(t,"<div>".concat(i,"</div>"),{childrenOnly:!0,onBeforeNodeAdded:function(e){return L.discardError(e),e},onNodeAdded:function(t){if(L.isPhxChild(t)&&e.ownsElement(t))return e.onNewChildAdded(t),!0},onBeforeNodeDiscarded:function(t){if(L.isPhxChild(t))return e.liveSocket.destroyViewById(t.id),!0},onBeforeElUpdated:function(e,t){return L.isPhxChild(t)?(L.mergeAttrs(e,t),!1):(e.getAttribute&&e.getAttribute("data-phx-has-submitted")&&t.setAttribute("data-phx-has-submitted",!0),e.getAttribute&&e.getAttribute("data-phx-has-focused")&&t.setAttribute("data-phx-has-focused",!0),L.discardError(t),!L.isTextualInput(e)||e!==r||(L.mergeInputs(e,t),!1))}}),e.liveSocket.silenceEvents(function(){L.restoreFocus(r,o,u)}),document.dispatchEvent(new Event("phx:update"))},mergeAttrs:function(e,t){t.getAttributeNames().forEach(function(n){var i=t.getAttribute(n);e.setAttribute(n,i)})},mergeInputs:function(e,t){L.mergeAttrs(e,t),e.readOnly=t.readOnly},restoreFocus:function(e,t,n){L.isTextualInput(e)&&((""===e.value||e.readOnly)&&e.blur(),e.focus(),(e.setSelectionRange&&"text"===e.type||"textarea"===e.type)&&e.setSelectionRange(t,n))},isTextualInput:function(e){return g.indexOf(e.type)>=0}},V=function(){function e(n,i,r){var o=this;t(this,e),this.liveSocket=i,this.parent=r,this.newChildrenAdded=!1,this.gracefullyClosed=!1,this.el=n,this.loader=this.el.nextElementSibling,this.id=this.el.id,this.view=this.el.getAttribute(b),this.channel=this.liveSocket.channel("lv:".concat(this.id),function(){return{session:o.getSession()}}),this.loaderTimer=setTimeout(function(){return o.showLoader()},A),this.bindChannel()}return i(e,[{key:"getSession",value:function(){return this.el.getAttribute("data-phx-session")}},{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.hasGracefullyClosed()?(this.log("destroyed",function(){return["the server view has gracefully closed"]}),e()):(this.log("destroyed",function(){return["the child has been removed from the parent"]}),this.channel.leave().receive("ok",e).receive("error",e).receive("timeout",e))}},{key:"hideLoader",value:function(){clearTimeout(this.loaderTimer),this.loader.style.display="none"}},{key:"showLoader",value:function(){clearTimeout(this.loaderTimer),this.el.classList="phx-disconnected",this.loader.style.display="block";var e=Math.floor(this.el.clientHeight/2);this.loader.style.top="-".concat(e,"px")}},{key:"log",value:function(e,t){this.liveSocket.log(this,e,t)}},{key:"onJoin",value:function(e){var t=e.rendered;this.log("join",function(){return["",JSON.stringify(t)]}),this.rendered=t,this.hideLoader(),this.el.classList="phx-connected",L.patch(this,this.el,this.id,C.toString(this.rendered)),this.joinNewChildren()}},{key:"joinNewChildren",value:function(){var e=this,t="".concat(m,"[").concat("data-phx-parent-id",'="').concat(this.id,'"]');document.querySelectorAll(t).forEach(function(t){e.liveSocket.getViewById(t.id)||e.liveSocket.joinView(t,e)})}},{key:"update",value:function(e){if(t=e,0!==Object.keys(t).length){var t;this.log("update",function(){return["",JSON.stringify(e)]}),this.rendered=C.mergeDiff(this.rendered,e);var n=C.toString(this.rendered);this.newChildrenAdded=!1,L.patch(this,this.el,this.id,n),this.newChildrenAdded&&this.joinNewChildren()}}},{key:"onNewChildAdded",value:function(e){this.newChildrenAdded=!0}},{key:"bindChannel",value:function(){var e=this;this.channel.on("render",function(t){return e.update(t)}),this.channel.on("redirect",function(e){var t=e.to,n=e.flash;return T.redirect(t,n)}),this.channel.on("session",function(t){var n=t.token;return e.el.setAttribute("data-phx-session",n)}),this.channel.onError(function(t){return e.onError(t)}),this.channel.onClose(function(){return e.onGracefulClose()})}},{key:"onGracefulClose",value:function(){this.gracefullyClosed=!0,this.liveSocket.destroyViewById(this.id)}},{key:"hasGracefullyClosed",value:function(){return this.gracefullyClosed}},{key:"join",value:function(){var e=this;this.parent&&(this.parent.channel.onClose(function(){return e.onGracefulClose()}),this.parent.channel.onError(function(){return e.liveSocket.destroyViewById(e.id)})),this.channel.join().receive("ok",function(t){return e.onJoin(t)}).receive("error",function(t){return e.onJoinError(t)}).receive("timeout",function(){return e.onJoinError("timeout")})}},{key:"onJoinError",value:function(e){this.displayError(),this.log("error",function(){return["unable to join",e]})}},{key:"onError",value:function(e){this.log("error",function(){return["view crashed",e]}),this.liveSocket.onViewError(this),document.activeElement.blur(),this.liveSocket.isUnloaded()?this.showLoader():this.displayError()}},{key:"displayError",value:function(){this.showLoader(),this.el.classList="".concat("phx-disconnected"," ").concat("phx-error")}},{key:"pushWithReply",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.channel.push(e,t,2e4).receive("ok",function(e){n.update(e),i()})}},{key:"pushEvent",value:function(e,t,n){var i=t.getAttribute(this.binding("value"))||t.value||"";this.pushWithReply("event",{type:e,event:n,value:i})}},{key:"pushKey",value:function(e,t,n,i){this.pushWithReply("event",{type:t,event:i,value:e.value||n.key})}},{key:"pushInput",value:function(e,t){this.pushWithReply("event",{type:"form",event:t,value:S(e.form)})}},{key:"pushFormSubmit",value:function(e,t,n){this.pushWithReply("event",{type:"form",event:t,value:S(e)},n)}},{key:"ownsElement",value:function(e){return e.getAttribute("data-phx-parent-id")===this.id||x(e.closest(m),"id")===this.id}},{key:"submitForm",value:function(e,t){var n=this,i=this.liveSocket.getBindingPrefix();e.setAttribute("data-phx-has-submitted","true"),L.disableForm(e,i),this.liveSocket.blurActiveElement(this),this.pushFormSubmit(e,t,function(){L.restoreDisabledForm(e,i),n.liveSocket.restorePreviouslyActiveFocus()})}},{key:"binding",value:function(e){return this.liveSocket.binding(e)}}]),e}();export default N;export{T as Browser,N as LiveSocket,C as Rendered,V as View,w as debug};
//# sourceMappingURL=phoenix_live_view.js.map
